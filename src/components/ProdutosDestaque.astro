---
import { getAllProducts } from "../data/products.js";

// Shuffle (Fisher-Yates)
function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

const allProducts = getAllProducts();
const randomProducts = shuffleArray(allProducts).slice(0, 6);
---

<div class="featured-container py-12">
  <h2 class="text-3xl font-bold text-center mb-10 text-gray-800">
    Produtos em Destaque
  </h2>

  <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
    {randomProducts.map((product) => (
      <a
        href={`/${product.category}/${product.id}`}
        key={product.id}
        class="group block bg-white rounded-2xl shadow-md hover:shadow-xl transition-all duration-300 overflow-hidden"
      >
        <div class="aspect-square relative bg-gradient-to-br from-rose-100 to-pink-200 flex items-center justify-center">
          <img
            src={product.imageUrl}
            alt={product.title}
            class="max-h-[80%] max-w-[80%] object-contain transition-transform duration-500 group-hover:scale-110"
          />
          <div class="absolute inset-0 bg-black/0 group-hover:bg-black/10 transition-all duration-500"></div>
        </div>

        <div class="p-5">
          <h3 class="font-semibold text-gray-800 mb-2 group-hover:text-primary transition-colors">
            {product.title}
          </h3>
          <p class="text-gray-600 text-sm mb-3 line-clamp-2">
            {product.description}
          </p>
          <div class="flex items-center justify-between">
            <span class="text-primary font-bold">
              {new Intl.NumberFormat("pt-BR", {
                style: "currency",
                currency: "BRL",
              }).format(product.price)}
            </span>
            <span class="text-xs text-gray-500 capitalize">{product.category}</span>
          </div>
        </div>
      </a>
    ))}
  </div>
</div>

<style>
  .featured-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }

  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
