---
import ProductCard from './ProductCard.astro';
import { getAllProducts } from '../data/products.js';

// Fun√ß√£o para embaralhar array (Fisher-Yates shuffle)
function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}

// Obter todos os produtos e selecionar 6 aleat√≥rios
const allProducts = getAllProducts();
const randomProducts = shuffleArray(allProducts).slice(0, 6);
---

<div class="product-carousel-container">
  <h2 class="text-3xl font-bold text-center mb-8 text-gray-800">Produtos em Destaque</h2>
  
  <div class="carousel-wrapper relative overflow-hidden">
    <div 
      class="carousel-track flex transition-transform duration-500 ease-in-out" 
      id="carouselTrack"
    >
      {randomProducts.map((product, index) => (
        <div 
          class="carousel-slide min-w-full md:min-w-1/2 lg:min-w-1/3 px-4" 
          key={product.id}
        >
          <a 
            href={`/${product.category}/${product.id}`}
            class="block bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 overflow-hidden group"
          >
            <!-- Imagem do produto -->
            <div class="aspect-square bg-rose-100 flex items-center justify-center relative overflow-hidden">
              <span class="text-4xl group-hover:scale-110 transition-transform duration-300">üß∂</span>
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-10 transition-all duration-300"></div>
            </div>
            
            <!-- Informa√ß√µes do produto -->
            <div class="p-4">
              <h3 class="font-semibold text-gray-800 mb-2 group-hover:text-primary transition-colors">
                {product.title}
              </h3>
              <p class="text-gray-600 text-sm mb-3 line-clamp-2">
                {product.description}
              </p>
              <div class="flex items-center justify-between">
                <span class="text-primary font-bold">
                  {new Intl.NumberFormat('pt-BR', {
                    style: 'currency',
                    currency: 'BRL'
                  }).format(product.price)}
                </span>
                <span class="text-xs text-gray-500 capitalize">
                  {product.category}
                </span>
              </div>
            </div>
          </a>
        </div>
      ))}
    </div>
  </div>
  
  <!-- Controles de navega√ß√£o -->
  <div class="flex justify-center mt-6 space-x-4">
    <button 
      class="carousel-prev bg-primary text-white p-2 rounded-full hover:bg-pink-600 transition-colors"
      onclick="moveCarousel(-1)"
      aria-label="Produto anterior"
    >
      ‚Üê
    </button>
    <button 
      class="carousel-next bg-primary text-white p-2 rounded-full hover:bg-pink-600 transition-colors"
      onclick="moveCarousel(1)"
      aria-label="Pr√≥ximo produto"
    >
      ‚Üí
    </button>
  </div>
</div>

<style>
  .product-carousel-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 1rem;
  }
  
  .carousel-wrapper {
    margin: 0 -1rem;
  }
  
  .carousel-track {
    will-change: transform;
  }
  
  .carousel-slide {
    flex-shrink: 0;
    transition: opacity 0.3s ease;
  }
  
  @media (min-width: 768px) {
    .carousel-slide {
      min-width: 50%;
    }
  }
  
  @media (min-width: 1024px) {
    .carousel-slide {
      min-width: 33.333%;
    }
  }
  
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>

<script>
  let currentIndex = 0;
  const track = document.getElementById('carouselTrack');
  const slides = document.querySelectorAll('.carousel-slide');
  
  function updateCarousel() {
    const slideWidth = slides[0].offsetWidth;
    track.style.transform = `translateX(-${currentIndex * slideWidth}px)`;
  }
  
  function moveCarousel(direction) {
    const totalSlides = slides.length;
    currentIndex = (currentIndex + direction + totalSlides) % totalSlides;
    updateCarousel();
  }
  
  // Inicializar carrossel
  if (typeof window !== 'undefined') {
    window.moveCarousel = moveCarousel;
    
    // Auto-rotate a cada 5 segundos
    setInterval(() => moveCarousel(1), 5000);
    
    // Atualizar no redimensionamento
    window.addEventListener('resize', updateCarousel);
    
    // Inicializar posi√ß√£o
    setTimeout(updateCarousel, 100);
  }
</script>